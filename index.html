<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RamDev Shop - Sweets & Cakes</title>
    <!-- External Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    
    <!-- React & Babel Globals (UMD for maximum WebView compatibility) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
      body {
        font-family: 'Inter', sans-serif;
        background-color: #fffaf0;
        margin: 0;
        padding: 0;
        -webkit-tap-highlight-color: transparent;
      }
      #loader {
        position: fixed;
        inset: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: #fffaf0;
        z-index: 9999;
        transition: opacity 0.4s ease-out;
      }
      .spinner {
        width: 45px;
        height: 45px;
        border: 4px solid #fed7aa;
        border-top: 4px solid #ea580c;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }
      @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
      
      h1, h2, h3 { font-family: 'Playfair Display', serif; }
      .no-scrollbar::-webkit-scrollbar { display: none; }
      .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
      
      .product-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
      }
      
      .fade-in {
        animation: fadeIn 0.3s ease-in-out;
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }

      .animate-slideUp {
        animation: slideUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1);
      }
      @keyframes slideUp {
        from { transform: translateY(100%); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
      }

      .shadow-soft {
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.05);
      }
      
      .qty-btn {
        @apply flex items-center justify-center w-8 h-8 rounded-lg bg-white text-orange-600 border border-orange-200 active:scale-90 transition-all shadow-sm;
      }
    </style>
  <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
  <body>
    <!-- Initial Loading Screen -->
    <div id="loader" role="status" aria-label="Loading application">
      <div class="spinner"></div>
      <p id="loader-title" style="margin-top: 20px; font-weight: 700; color: #9a3412; font-family: 'Playfair Display', serif; font-size: 22px;">RamDev Shop</p>
      <p id="loader-sub" style="margin-top: 8px; font-size: 13px; color: #c2410c; opacity: 0.8; font-weight: 500;">Fresh & Delicious...</p>
    </div>

    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useMemo, useCallback } = React;

      /** --- CONFIGURATION DEFAULTS --- **/
      const SHOP_NAME = "RamDev Shop";
      const ADMIN_PASSWORD = "Pawan1645@";

      const AdminDashboard = ({ 
        appData, 
        onUpdateAppData, 
        onBack 
      }) => {
        const [activeTab, setActiveTab] = useState('products');
        const [editingProduct, setEditingProduct] = useState(null);
        const [searchQuery, setSearchQuery] = useState('');
        
        const [ghToken, setGhToken] = useState(localStorage.getItem('gh_token') || '');
        const [ghRepo, setGhRepo] = useState(localStorage.getItem('gh_repo') || ''); 
        const [isSyncing, setIsSyncing] = useState(false);
        const [syncMessage, setSyncMessage] = useState('');

        const filteredProducts = (appData.products || []).filter(p => 
          (p.name || '').toLowerCase().includes(searchQuery.toLowerCase())
        );

        const handleSaveProduct = (p) => {
          const newList = p.isNew 
            ? [...appData.products, { ...p, id: Date.now().toString(), isNew: undefined }] 
            : appData.products.map(item => item.id === p.id ? p : item);
          onUpdateAppData({ ...appData, products: newList });
          setEditingProduct(null);
        };

        const deleteProduct = (id) => {
          if(confirm('Delete this product?')) {
            onUpdateAppData({ ...appData, products: appData.products.filter(p => p.id !== id) });
          }
        };

        const addCategory = () => {
          const name = prompt("Enter new category name:");
          if (name && !appData.categories.includes(name)) {
            onUpdateAppData({ ...appData, categories: [...appData.categories, name] });
          }
        };

        const deleteCategory = (cat) => {
          if (confirm(`Delete "${cat}" category? Products in this category will remain.`)) {
            onUpdateAppData({ ...appData, categories: appData.categories.filter(c => c !== cat) });
          }
        };

        const syncToGithub = async () => {
          if (!ghToken || !ghRepo) return alert("Please set GitHub Token and Repo User/Path.");
          setIsSyncing(true);
          setSyncMessage('Syncing...');
          localStorage.setItem('gh_token', ghToken);
          localStorage.setItem('gh_repo', ghRepo);

          try {
            const url = `https://api.github.com/repos/${ghRepo}/contents/app_data.json`;
            const res = await fetch(url, { headers: { 'Authorization': `token ${ghToken}`, 'Accept': 'application/vnd.github.v3+json' } });
            
            let sha = "";
            if (res.ok) {
              const fileData = await res.json();
              sha = fileData.sha;
            }

            const content = btoa(unescape(encodeURIComponent(JSON.stringify(appData, null, 2))));
            const putRes = await fetch(url, {
              method: 'PUT',
              headers: { 'Authorization': `token ${ghToken}`, 'Content-Type': 'application/json' },
              body: JSON.stringify({ 
                message: `Admin live update: ${new Date().toLocaleString()}`, 
                content: content, 
                sha: sha || undefined 
              })
            });

            if (!putRes.ok) throw new Error('Push failed. Ensure token and repo path are correct.');
            setSyncMessage('SUCCESS!');
            setTimeout(() => setSyncMessage(''), 3000);
          } catch (err) { 
            alert("Error: " + err.message); 
            setSyncMessage('Failed'); 
          } finally { 
            setIsSyncing(false); 
          }
        };

        return (
          <div className="min-h-screen bg-gray-50 pb-40 fade-in p-4 pt-8 text-left">
            <div className="flex items-center justify-between mb-8 px-2">
              <h1 className="text-2xl font-black text-gray-900 uppercase tracking-tighter">ADMIN PANEL</h1>
              <button onClick={onBack} className="w-10 h-10 bg-white rounded-full flex items-center justify-center border border-gray-100 shadow-sm"><i className="fas fa-times text-gray-400"></i></button>
            </div>

            <div className="flex gap-2 mb-6 overflow-x-auto no-scrollbar py-2">
              {['products', 'categories', 'settings', 'sync'].map(tab => (
                <button 
                  key={tab} 
                  onClick={() => setActiveTab(tab)}
                  className={`px-4 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${activeTab === tab ? 'bg-orange-600 text-white shadow-lg' : 'bg-white text-gray-400 border border-gray-100'}`}
                >
                  {tab}
                </button>
              ))}
            </div>

            {activeTab === 'products' && (
              <div className="space-y-4">
                <div className="flex gap-2">
                  <input type="text" placeholder="Search..." className="flex-1 px-6 py-4 bg-white rounded-2xl border border-gray-100 outline-none shadow-soft" value={searchQuery} onChange={e => setSearchQuery(e.target.value)} />
                  <button onClick={() => setEditingProduct({ id: '', name: '', price: 0, weight: '', category: appData.categories[0] || 'Sweets', image: '', description: '', isNew: true })} className="w-14 h-14 bg-orange-600 text-white rounded-2xl shadow-lg flex items-center justify-center">
                    <i className="fas fa-plus"></i>
                  </button>
                </div>
                <div className="space-y-3">
                  {filteredProducts.map(p => (
                    <div key={p.id} className="bg-white p-4 rounded-2xl border border-orange-50 shadow-soft flex items-center gap-4">
                      <img src={p.image} className="w-12 h-12 object-cover rounded-xl bg-gray-100" />
                      <div className="flex-1">
                        <h4 className="font-black text-sm text-gray-900 leading-tight">{p.name}</h4>
                        <p className="text-[10px] text-gray-400 font-bold">‚Çπ{p.price} ‚Ä¢ {p.category}</p>
                      </div>
                      <div className="flex gap-2">
                        <button onClick={() => setEditingProduct(p)} className="w-9 h-9 bg-orange-50 text-orange-600 rounded-xl flex items-center justify-center"><i className="fas fa-pen text-[11px]"></i></button>
                        <button onClick={() => deleteProduct(p.id)} className="w-9 h-9 bg-red-50 text-red-600 rounded-xl flex items-center justify-center"><i className="fas fa-trash text-[11px]"></i></button>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {activeTab === 'categories' && (
              <div className="space-y-4">
                <button onClick={addCategory} className="w-full py-4 bg-orange-600 text-white rounded-2xl font-black shadow-lg uppercase text-xs tracking-widest">Add New Category</button>
                <div className="grid grid-cols-1 gap-2">
                  {appData.categories.map(cat => (
                    <div key={cat} className="bg-white p-4 rounded-2xl flex justify-between items-center shadow-soft border border-orange-50">
                      <span className="font-bold text-gray-800 uppercase text-xs tracking-widest">{cat}</span>
                      <button onClick={() => deleteCategory(cat)} className="text-red-500 p-2"><i className="fas fa-trash"></i></button>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {activeTab === 'settings' && (
              <div className="bg-white p-6 rounded-3xl shadow-soft border border-orange-50 space-y-6">
                <div>
                  <label className="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-2 block">Owner WhatsApp (91XXXXXXXXXX)</label>
                  <input type="text" className="w-full p-4 bg-gray-50 rounded-xl outline-none font-bold" value={appData.settings.ownerWhatsApp} onChange={e => onUpdateAppData({...appData, settings: {...appData.settings, ownerWhatsApp: e.target.value}})} />
                </div>
                <div>
                  <label className="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-2 block">UPI ID for Payments</label>
                  <input type="text" className="w-full p-4 bg-gray-50 rounded-xl outline-none font-bold" value={appData.settings.upiId} onChange={e => onUpdateAppData({...appData, settings: {...appData.settings, upiId: e.target.value}})} />
                </div>
                <div className="border-t border-orange-50 pt-4">
                  <label className="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-2 block">Min Order Amount (‚Çπ)</label>
                  <input type="number" className="w-full p-4 bg-gray-50 rounded-xl outline-none font-bold" value={appData.settings.minOrder} onChange={e => onUpdateAppData({...appData, settings: {...appData.settings, minOrder: parseInt(e.target.value) || 0}})} />
                </div>
                <div>
                  <label className="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-2 block">Platform Fee (‚Çπ)</label>
                  <input type="number" className="w-full p-4 bg-gray-50 rounded-xl outline-none font-bold" value={appData.settings.platformFee} onChange={e => onUpdateAppData({...appData, settings: {...appData.settings, platformFee: parseInt(e.target.value) || 0}})} />
                </div>
                <div>
                  <label className="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-2 block">Delivery Fee (‚Çπ)</label>
                  <input type="number" className="w-full p-4 bg-gray-50 rounded-xl outline-none font-bold" value={appData.settings.deliveryFee} onChange={e => onUpdateAppData({...appData, settings: {...appData.settings, deliveryFee: parseInt(e.target.value) || 0}})} />
                </div>
              </div>
            )}

            {activeTab === 'sync' && (
              <div className="bg-white p-6 rounded-3xl shadow-soft border border-orange-50">
                <h3 className="text-xs font-black text-gray-400 uppercase tracking-widest mb-4">GitHub Configuration</h3>
                <div className="space-y-3">
                  <input className="w-full p-4 bg-gray-50 rounded-xl outline-none text-xs font-mono" placeholder="GitHub Token" value={ghToken} onChange={e => setGhToken(e.target.value)} />
                  <input className="w-full p-4 bg-gray-50 rounded-xl outline-none text-xs font-mono" placeholder="User/Repo" value={ghRepo} onChange={e => setGhRepo(e.target.value)} />
                  <button disabled={isSyncing} onClick={syncToGithub} className={`w-full py-4 rounded-xl font-black text-xs uppercase tracking-widest flex items-center justify-center gap-3 transition-all ${isSyncing ? 'bg-orange-200 text-white' : 'bg-orange-600 text-white shadow-lg'}`}>
                    <i className={`fas ${isSyncing ? 'fa-sync fa-spin' : 'fa-cloud-upload-alt'}`}></i> {syncMessage || 'PUSH ALL CHANGES LIVE'}
                  </button>
                </div>
              </div>
            )}

            {editingProduct && (
              <div className="fixed inset-0 z-[100] bg-black/60 backdrop-blur-sm flex items-end justify-center p-4">
                <div className="bg-white w-full max-w-md rounded-t-[40px] p-8 animate-slideUp overflow-y-auto max-h-[90vh]">
                  <h3 className="text-xl font-black mb-6 uppercase text-gray-900">Edit Product</h3>
                  <div className="space-y-4 text-left">
                    <input className="w-full p-4 bg-gray-50 rounded-xl outline-none font-bold" placeholder="Product Name" value={editingProduct.name} onChange={e => setEditingProduct({...editingProduct, name: e.target.value})} />
                    <textarea className="w-full p-4 bg-gray-50 rounded-xl outline-none text-sm" rows="2" placeholder="Description" value={editingProduct.description} onChange={e => setEditingProduct({...editingProduct, description: e.target.value})} />
                    <div className="grid grid-cols-2 gap-3">
                      <input type="number" className="w-full p-4 bg-gray-50 rounded-xl outline-none" placeholder="Price" value={editingProduct.price} onChange={e => setEditingProduct({...editingProduct, price: parseInt(e.target.value) || 0})} />
                      <input className="w-full p-4 bg-gray-50 rounded-xl outline-none" placeholder="Weight" value={editingProduct.weight} onChange={e => setEditingProduct({...editingProduct, weight: e.target.value})} />
                    </div>
                    <select className="w-full p-4 bg-gray-50 rounded-xl outline-none font-bold text-gray-700" value={editingProduct.category} onChange={e => setEditingProduct({...editingProduct, category: e.target.value})}>
                      {appData.categories.map(c => <option key={c} value={c}>{c}</option>)}
                    </select>
                    <input className="w-full p-4 bg-gray-50 rounded-xl outline-none text-xs" placeholder="Image URL/Filename" value={editingProduct.image} onChange={e => setEditingProduct({...editingProduct, image: e.target.value})} />
                    <div className="pt-4 flex gap-3">
                      <button onClick={() => setEditingProduct(null)} className="flex-1 py-4 bg-gray-100 text-gray-400 rounded-2xl font-black uppercase text-xs">Cancel</button>
                      <button onClick={() => handleSaveProduct(editingProduct)} className="flex-2 py-4 bg-orange-600 text-white rounded-2xl font-black px-8 uppercase text-xs shadow-lg">Save</button>
                    </div>
                  </div>
                </div>
              </div>
            )}
          </div>
        );
      };

      const AdminLogin = ({ onLogin, onBack }) => {
        const [pass, setPass] = useState('');
        const [error, setError] = useState(false);
        const handleLogin = () => {
          if (pass === ADMIN_PASSWORD) onLogin();
          else { setError(true); setTimeout(() => setError(false), 2000); }
        };
        return (
          <div className="min-h-screen bg-white flex flex-col items-center justify-center p-8 fade-in text-center">
            <div className={`w-20 h-20 rounded-3xl mb-6 flex items-center justify-center text-3xl transition-all ${error ? 'bg-red-100 text-red-600' : 'bg-orange-100 text-orange-600'}`}>
              <i className={`fas ${error ? 'fa-lock' : 'fa-user-shield'}`}></i>
            </div>
            <h1 className="text-3xl font-black text-gray-900 mb-2 leading-none uppercase tracking-tighter">ADMIN PANEL</h1>
            <p className="text-gray-500 text-sm mb-8 px-4">Authorized access only.</p>
            <div className="w-full max-w-xs space-y-4">
              <input type="password" placeholder="Password" className="w-full p-4 bg-gray-50 rounded-2xl border-2 border-transparent focus:border-orange-500 outline-none text-center font-bold tracking-widest shadow-inner" value={pass} onChange={e => setPass(e.target.value)} onKeyPress={e => e.key === 'Enter' && handleLogin()} />
              <button onClick={handleLogin} className="w-full py-4 bg-orange-600 text-white rounded-2xl font-black shadow-xl active:scale-95 uppercase text-sm tracking-widest">LOGIN</button>
              <button onClick={onBack} className="text-gray-400 font-bold text-xs uppercase tracking-widest pt-4 underline">Back to Menu</button>
            </div>
          </div>
        );
      };

      const App = () => {
        const [view, setView] = useState('onboarding'); 
        const [isLoading, setIsLoading] = useState(true);
        const [appData, setAppData] = useState({
          products: [],
          categories: ['Sweets', 'Cakes', 'Snacks', 'Drinks'],
          settings: { 
            minOrder: 100, 
            platformFee: 1, 
            deliveryFee: 10,
            ownerWhatsApp: "919867637326",
            upiId: "pawanponnam-1@okicici"
          }
        });
        const [cart, setCart] = useState([]);
        const [category, setCategory] = useState('Sweets');
        const [profile, setProfile] = useState(null);
        const [deliveryMethod, setDeliveryMethod] = useState('home');
        const [paymentMethod, setPaymentMethod] = useState('cod');

        const fetchData = async () => {
          const variations = [`./app_data.json?v=${Date.now()}`, `./app_data.json`, `./products.json` ];
          for (const path of variations) {
            try { 
              const res = await fetch(path);
              if (!res.ok) continue;
              const data = await res.json();
              if (Array.isArray(data)) {
                setAppData(prev => ({ ...prev, products: data }));
                return true;
              } else if (data.products) {
                const mergedSettings = {
                  minOrder: 100,
                  platformFee: 1,
                  deliveryFee: 10,
                  ownerWhatsApp: "919867637326",
                  upiId: "pawanponnam-1@okicici",
                  ...data.settings
                };
                setAppData({ ...data, settings: mergedSettings });
                if (data.categories?.length > 0) setCategory(data.categories[0]);
                return true;
              }
            } catch(e) {}
          }
          return false;
        };

        useEffect(() => {
          const init = async () => {
            await fetchData();
            const stored = localStorage.getItem('ramdev_profile');
            if (stored) { 
              try {
                const parsed = JSON.parse(stored);
                setProfile(parsed);
                setView('catalog');
              } catch(e) { localStorage.removeItem('ramdev_profile'); }
            }
            setIsLoading(false);
          };
          init();
        }, []);

        useEffect(() => {
          const loader = document.getElementById('loader');
          if (loader && !isLoading) { loader.style.opacity = '0'; setTimeout(() => loader.remove(), 400); }
        }, [isLoading]);

        const updateCart = (product, delta) => {
          setCart(prev => {
            const existing = prev.find(i => i.id === product.id);
            if (existing) {
              const newQty = existing.quantity + delta;
              if (newQty <= 0) return prev.filter(i => i.id !== product.id);
              return prev.map(i => i.id === product.id ? { ...i, quantity: newQty } : i);
            }
            if (delta > 0) return [...prev, { ...product, quantity: delta }];
            return prev;
          });
        };

        const getItemQty = (id) => {
          const item = cart.find(i => i.id === id);
          return item ? item.quantity : 0;
        };

        // CART TOTAL (products only)
const cartTotal = cart.reduce(
  (sum, item) => sum + item.price * item.quantity,
  0
);

// DELIVERY FEE
const deliveryFee =
  deliveryMethod === 'home'
    ? appData.settings.deliveryFee
    : 0;

// GRAND TOTAL
const totalWithFees =
  cartTotal + appData.settings.platformFee + deliveryFee;

// ‚úÖ CHECKOUT LOGIC (FIXED)
const canCheckout =
  deliveryMethod === 'pickup'
    ? cartTotal > 0
    : cartTotal >= appData.settings.minOrder;

        const handleFinalOrder = () => {
          if (!profile) return;
          const msg = `üõçÔ∏è *ORDER: ${SHOP_NAME}*\n\nüë§ *Customer:* ${profile.fullName}\nüìû *Phone:* ${profile.phone}\nüìç *Address:* ${profile.address}\n\nüöö *Method:* ${deliveryMethod === 'home' ? 'Home Delivery' : 'Pickup'}\nüí≥ *Payment:* ${paymentMethod === 'cod' ? 'Cash' : 'UPI Scan'}\n\nüç∞ *Items:*\n${cart.map(i => `‚Ä¢ ${i.name} (x${i.quantity}) - ‚Çπ${i.price * i.quantity}`).join('\n')}\n\nüí∞ *Subtotal: ‚Çπ${cartTotal}*\n‚öôÔ∏è *Platform: ‚Çπ${appData.settings.platformFee}*\nüöö *Delivery: ‚Çπ${deliveryFee}*\nüî• *Grand Total: ‚Çπ${totalWithFees}*`;
          window.location.href = `https://api.whatsapp.com/send?phone=${appData.settings.ownerWhatsApp}&text=${encodeURIComponent(msg)}`;
          setCart([]); setView('catalog');
        };

        if (isLoading) return null;
        if (view === 'admin_login') return <AdminLogin onLogin={() => setView('admin_panel')} onBack={() => setView('catalog')} />;
        if (view === 'admin_panel') return <AdminDashboard appData={appData} onUpdateAppData={setAppData} onBack={() => setView('catalog')} />;

        if (view === 'onboarding' || view === 'edit_profile') {
          return (
            <div className="min-h-screen bg-white p-8 flex flex-col fade-in">
              <div className="mt-12 mb-10 text-center">
                <div className="w-20 h-20 bg-orange-100 rounded-3xl mx-auto flex items-center justify-center text-orange-600 text-3xl mb-4 shadow-soft"><i className="fas fa-hand-sparkles"></i></div>
                <h1 className="text-3xl font-black text-gray-900 uppercase tracking-tighter">Welcome!</h1>
                <p className="text-gray-500 text-sm mt-2">Enter your delivery details to browse the shop.</p>
              </div>
              <div className="space-y-4 flex-1">
                <input className="w-full p-4 bg-gray-50 rounded-2xl border-none outline-none font-medium shadow-inner" placeholder="Full Name" defaultValue={profile?.fullName} id="name-input" />
                <input className="w-full p-4 bg-gray-50 rounded-2xl border-none outline-none font-medium shadow-inner" placeholder="WhatsApp Number" defaultValue={profile?.phone} id="phone-input" />
                <textarea className="w-full p-4 bg-gray-50 rounded-2xl border-none outline-none font-medium resize-none shadow-inner" placeholder="Exact Delivery Address" rows="3" defaultValue={profile?.address} id="address-input" />
              </div>
              <button onClick={() => {
                const name = document.getElementById('name-input').value;
                const phone = document.getElementById('phone-input').value;
                const address = document.getElementById('address-input').value;
                if(name && phone && address) {
                  const data = { fullName: name, phone, address };
                  setProfile(data); localStorage.setItem('ramdev_profile', JSON.stringify(data)); setView('catalog');
                } else alert('All fields are required');
              }} className="w-full py-5 bg-orange-600 text-white rounded-2xl font-black shadow-xl mt-8 active:scale-95 transition-all uppercase text-sm tracking-widest">SAVE & START</button>
              <button onClick={() => setView('admin_login')} className="text-gray-300 font-bold text-[10px] uppercase mt-10 text-center tracking-widest"><i className="fas fa-lock"></i> OWNER ACCESS</button>
            </div>
          );
        }

        if (view === 'catalog') return (
          <div className="min-h-screen max-w-md mx-auto bg-[#fffaf0]">
            <header className="fixed top-0 left-0 right-0 max-w-md mx-auto z-50 bg-white/95 backdrop-blur-sm shadow-sm px-4 py-3 flex items-center justify-between">
              <div className="flex items-center gap-2" onClick={() => setView('edit_profile')}>
                <div className="w-9 h-9 bg-orange-600 rounded-lg flex items-center justify-center text-white"><i className="fas fa-user text-xs"></i></div>
                <div className="text-left leading-none">
                  <h1 className="text-sm font-black text-gray-900 leading-tight">{SHOP_NAME}</h1>
                  <p className="text-[9px] font-bold text-orange-600 mt-0.5 uppercase">Hi, {profile?.fullName?.split(' ')[0] || 'User'}</p>
                </div>
              </div>
              <button onClick={() => setView('cart')} className="relative w-10 h-10 flex items-center justify-center text-gray-700">
                <i className="fas fa-shopping-basket text-xl"></i>
                {cart.length > 0 && <span className="absolute -top-1 -right-1 bg-red-600 text-white text-[9px] font-black w-4 h-4 rounded-full flex items-center justify-center border-2 border-white">{cart.length}</span>}
              </button>
            </header>
            <main className="pt-20 pb-40 px-4 fade-in">
              <nav className="flex gap-2 mb-6 overflow-x-auto no-scrollbar py-2">
                {appData.categories.map(cat => (
                  <button key={cat} onClick={() => setCategory(cat)} className={`px-6 py-2 rounded-full text-[11px] font-black uppercase shadow-sm flex-shrink-0 transition-all ${category === cat ? 'bg-orange-600 text-white' : 'bg-white text-orange-900 border border-orange-100'}`}>{cat}</button>
                ))}
              </nav>
              <div className="product-grid">
                {(appData.products || []).filter(p => p.category === category).map(p => {
                  const qty = getItemQty(p.id);
                  return (
                    <div key={p.id} className="bg-white rounded-2xl overflow-hidden shadow-soft border border-orange-50 flex flex-col h-full text-left transition-all">
                      <div className="h-32 bg-gray-100 overflow-hidden relative">
                        <img src={p.image} className="w-full h-full object-cover" alt={p.name} />
                        <div className="absolute bottom-2 right-2">
                          {qty === 0 ? (
                            <button onClick={() => updateCart(p, 1)} className="px-5 py-1.5 bg-white text-orange-600 font-black text-[10px] rounded-lg border border-orange-200 shadow-lg active:scale-95 transition-all uppercase tracking-wider">Add</button>
                          ) : (
                            <div className="flex items-center bg-white rounded-lg border border-orange-200 shadow-lg overflow-hidden">
                              <button onClick={() => updateCart(p, -1)} className="px-2.5 py-1.5 text-orange-600 active:bg-orange-50"><i className="fas fa-minus text-[8px]"></i></button>
                              <span className="px-2 text-xs font-black text-orange-900">{qty}</span>
                              <button onClick={() => updateCart(p, 1)} className="px-2.5 py-1.5 text-orange-600 active:bg-orange-50"><i className="fas fa-plus text-[8px]"></i></button>
                            </div>
                          )}
                        </div>
                      </div>
                      <div className="p-3 flex-1 flex flex-col">
                        <h3 className="text-sm font-bold text-gray-900 mb-1 leading-tight">{p.name}</h3>
                        <p className="text-[10px] text-gray-400 mb-3 flex-1 line-clamp-2">{p.description}</p>
                        <div className="mt-auto flex justify-between items-center"><span className="text-sm font-black text-orange-600">‚Çπ{p.price}</span><span className="text-[8px] font-bold text-gray-300 uppercase tracking-tighter">{p.weight}</span></div>
                      </div>
                    </div>
                  );
                })}
              </div>
            </main>
            {cart.length > 0 && (
              <div className="fixed bottom-6 left-4 right-4 max-w-md mx-auto animate-slideUp">
                <button onClick={() => setView('cart')} className="w-full bg-orange-600 text-white font-black py-4 rounded-2xl shadow-2xl flex justify-between px-6 items-center border-4 border-white/20 active:scale-95 transition-all">
                  <span>{cart.length} Items</span>
                  <span className="text-sm font-black uppercase tracking-widest">View Cart ‚Ä¢ ‚Çπ{totalWithFees} <i className="fas fa-arrow-right ml-2 text-[10px]"></i></span>
                </button>
              </div>
            )}
          </div>
        );

        if (view === 'cart') return (
          <div className="min-h-screen bg-white p-4 pt-16 text-left fade-in">
            <div className="flex items-center gap-4 mb-8"><button onClick={() => setView('catalog')} className="w-10 h-10 bg-gray-50 rounded-full flex items-center justify-center"><i className="fas fa-arrow-left"></i></button><h2 className="text-2xl font-black text-gray-900 tracking-tighter uppercase">Your Cart</h2></div>
            <div className="space-y-4 mb-8">
              {cart.map(item => (
                <div key={item.id} className="flex gap-4 p-4 bg-orange-50/30 rounded-2xl border border-orange-100/50">
                  <img src={item.image} className="w-16 h-16 object-cover rounded-xl" alt={item.name} />
                  <div className="flex-1">
                    <h4 className="font-bold text-sm text-gray-900">{item.name}</h4>
                    <p className="text-orange-600 font-black text-sm">‚Çπ{item.price * item.quantity}</p>
                    <div className="flex items-center gap-3 mt-1">
                      <button onClick={() => updateCart(item, -1)} className="w-6 h-6 bg-white rounded-lg border border-orange-100 text-xs flex items-center justify-center">-</button>
                      <span className="font-bold text-xs">{item.quantity}</span>
                      <button onClick={() => updateCart(item, 1)} className="w-6 h-6 bg-white rounded-lg border border-orange-100 text-xs flex items-center justify-center">+</button>
                    </div>
                  </div>
                  <button onClick={() => setCart(cart.filter(i => i.id !== item.id))} className="text-gray-300 p-2"><i className="fas fa-times text-xs"></i></button>
                </div>
              ))}
            </div>

            <div className="bg-gray-50 p-6 rounded-3xl space-y-3 mb-10 shadow-inner border border-orange-50">
              <div className="flex justify-between text-sm"><span className="text-gray-500 font-medium">Subtotal</span><span className="font-bold">‚Çπ{cartTotal}</span></div>
              <div className="flex justify-between text-sm"><span className="text-gray-500 font-medium">Platform Fee</span><span className="font-bold">‚Çπ{appData.settings.platformFee}</span></div>
              <div className="flex justify-between text-sm">
                <span className="text-gray-500 font-medium">Delivery Charge</span>
                <span className={`font-bold ${deliveryFee === 0 ? 'text-green-600' : ''}`}>{deliveryFee === 0 ? 'FREE' : '‚Çπ'+deliveryFee}</span>
              </div>
              
              {!canCheckout && <div className="bg-orange-100 text-orange-900 p-3 rounded-xl text-[10px] font-black text-center mt-4 uppercase tracking-tighter">Min. Order ‚Çπ{appData.settings.minOrder} required. Add ‚Çπ{appData.settings.minOrder - cartTotal} more.</div>}
              
              <div className="border-t border-gray-200 pt-3 flex justify-between font-black text-xl"><span>Grand Total</span><span className="text-orange-900">‚Çπ{totalWithFees}</span></div>
            </div>

            <button disabled={!canCheckout} onClick={() => setView('checkout')} className={`w-full py-5 rounded-2xl font-black shadow-xl uppercase transition-all tracking-widest ${canCheckout ? 'bg-orange-600 text-white active:scale-95' : 'bg-gray-200 text-gray-400'}`}>
              {canCheckout ? 'Proceed to Checkout' : `‚Çπ${appData.settings.minOrder - cartTotal} MORE NEEDED`}
            </button>
          </div>
        );

        if (view === 'checkout') return (
          <div className="min-h-screen bg-white p-4 pt-16 text-left fade-in">
            <div className="flex items-center gap-4 mb-8"><button onClick={() => setView('cart')} className="w-10 h-10 bg-gray-50 rounded-full flex items-center justify-center"><i className="fas fa-arrow-left"></i></button><h2 className="text-2xl font-black text-gray-900 tracking-tighter uppercase">Order Details</h2></div>
            
            <div className="space-y-8 pb-32">
              <div>
                <label className="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-4 block">Delivery Option</label>
                <div className="grid grid-cols-2 gap-3">
                  <button onClick={() => setDeliveryMethod('home')} className={`p-5 rounded-2xl border-2 flex flex-col items-center gap-2 transition-all ${deliveryMethod === 'home' ? 'border-orange-500 bg-orange-50 text-orange-900' : 'border-gray-50 bg-gray-50 text-gray-400'}`}>
                    <i className="fas fa-truck text-xl"></i><span className="text-[10px] font-black">Home Delivery</span>
                  </button>
                  <button onClick={() => setDeliveryMethod('pickup')} className={`p-5 rounded-2xl border-2 flex flex-col items-center gap-2 transition-all ${deliveryMethod === 'pickup' ? 'border-orange-500 bg-orange-50 text-orange-900' : 'border-gray-50 bg-gray-50 text-gray-400'}`}>
                    <i className="fas fa-store text-xl"></i><span className="text-[10px] font-black">Store Pickup</span>
                  </button>
                </div>
              </div>

              <div>
                <label className="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-4 block">Payment Method</label>
                <div className="space-y-3">
                  <button onClick={() => setPaymentMethod('cod')} className={`w-full p-5 rounded-2xl border-2 flex items-center gap-4 transition-all ${paymentMethod === 'cod' ? 'border-orange-500 bg-orange-50 text-orange-900' : 'border-gray-50 bg-gray-50 text-gray-400'}`}>
                    <i className="fas fa-money-bill-wave text-xl"></i><span className="text-[11px] font-black uppercase">Cash on Delivery</span>
                  </button>
                  <button onClick={() => setPaymentMethod('upi')} className={`w-full p-5 rounded-2xl border-2 flex items-center gap-4 transition-all ${paymentMethod === 'upi' ? 'border-orange-500 bg-orange-50 text-orange-900' : 'border-gray-50 bg-gray-50 text-gray-400'}`}>
                    <i className="fas fa-qrcode text-xl"></i><span className="text-[11px] font-black uppercase">Scan & Pay (UPI)</span>
                  </button>
                </div>
              </div>

              {paymentMethod === 'upi' && (
                <div className="bg-white p-6 rounded-3xl border-2 border-dashed border-orange-200 text-center animate-fadeIn shadow-sm">
                   <p className="text-[11px] font-black text-orange-900 mb-4 uppercase">Payable: ‚Çπ{totalWithFees}</p>
                   <img src={`https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=upi://pay?pa=${appData.settings.upiId}%26pn=${encodeURIComponent(SHOP_NAME)}%26am=${totalWithFees}%26cu=INR`} className="mx-auto w-44 h-44 rounded-xl shadow-lg border-4 border-white mb-4" alt="QR" />
                   <p className="text-[9px] text-gray-400 font-bold uppercase tracking-tight">Scan with any UPI app to pay</p>
                </div>
              )}

              <div className="bg-gray-900 p-6 rounded-3xl text-white shadow-xl">
                <div className="flex justify-between mb-1 text-xs opacity-60"><span>Items Total</span><span>‚Çπ{cartTotal}</span></div>
                <div className="flex justify-between mb-1 text-xs opacity-60"><span>Platform Fee</span><span>‚Çπ{appData.settings.platformFee}</span></div>
                {deliveryMethod === 'home' && <div className="flex justify-between mb-4 text-xs opacity-60"><span>Delivery Charge</span><span>{deliveryFee === 0 ? 'FREE' : '‚Çπ'+deliveryFee}</span></div>}
                <div className="flex justify-between items-center font-black text-2xl"><span>Grand Total</span><span className="text-orange-400">‚Çπ{totalWithFees}</span></div>
              </div>
            </div>

            <div className="fixed bottom-6 left-4 right-4 max-w-md mx-auto">
               <button onClick={handleFinalOrder} className="w-full bg-orange-600 text-white font-black py-5 rounded-2xl shadow-2xl flex items-center justify-center gap-3 uppercase active:scale-95 transition-all text-sm tracking-widest">
                Confirm on WhatsApp <i className="fab fa-whatsapp text-xl"></i>
               </button>
            </div>
          </div>
        );

        return null;
      };

      ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
  </body>
</html>